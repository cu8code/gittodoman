#! /usr/bin/env node
(()=>{var t={737:(e,t,o)=>{const n=o(147),s=o(977),i=o(37).homedir()+"/todomanconf";e.exports={get_config:async function(){if(!n.existsSync(i))return{};const e=await s.readFile(i,{encoding:"utf8"});return JSON.parse(e)},write_config:async function(e){console.log({PATH:i,str:e}),s.writeFile(i,e)}}},647:(e,t,o)=>{const{delay:n}=o(980);e.exports={get_token:async function(){const e=new Headers;e.append("Content-Type","application/json"),e.append("Accept","application/json");const t={method:"POST",headers:e,body:JSON.stringify({client_id:"afc775ea851677813e35",scope:"repo"})},o=await fetch("https://github.com/login/device/code",t),s=await o.text(),i=JSON.parse(s);return await async function(e){const t=e.user_code,o=e.verification_uri,s=e.expires_in,i=e.interval,r=e.device_code;console.log("#############################################################"),console.log("#############################################################"),console.log("user_code = ",t),console.log("uri = ",o),console.log("OPEN THE URI AND ENTER THE OTP(user_code)"),console.log("#############################################################"),console.log("#############################################################");const c=new Date;for(;;){if(new Date-c>1e3*s)return console.error("failed: session expired"),null;const e=new Headers;e.append("Content-Type","application/json"),e.append("Accept","application/json");const t={method:"POST",headers:e,body:JSON.stringify({client_id:"afc775ea851677813e35",device_code:r,grant_type:"urn:ietf:params:oauth:grant-type:device_code"})},o=await fetch("https://github.com/login/oauth/access_token",t),a=await o.text(),p=JSON.parse(a);if(console.log(p),p?.access_token)return p.access_token;await n(1e3*i)}}(i)},create_issue:async function(e,t,o){const n=new Headers;n.append("Accept","application/vnd.github+json"),n.append("Authorization","Bearer "+t),n.append("X-GitHub-Api-Version","2022-11-28"),n.append("Content-Type","text/plain");const s={method:"POST",headers:n,body:JSON.stringify({title:e})},i=await fetch(o,s),r=await i.text();console.log(r)}}},980:e=>{e.exports={delay:function(e){return new Promise((t=>setTimeout(t,e)))}}},147:e=>{"use strict";e.exports=require("fs")},718:e=>{"use strict";e.exports=require("node:child_process")},977:e=>{"use strict";e.exports=require("node:fs/promises")},37:e=>{"use strict";e.exports=require("os")},837:e=>{"use strict";e.exports=require("util")}},o={};function n(e){var s=o[e];if(void 0!==s)return s.exports;var i=o[e]={exports:{}};return t[e](i,i.exports,n),i.exports}(()=>{const t=n(737),o=n(647),s=n(837),i=n(977),r=s.promisify(n(718).exec),c=process.cwd();!async function(){let n=(await t.get_config()).token;n||(n=await o.get_token(),t.write_config(JSON.stringify({token:n})));const s=await async function(){let e=process.argv[2];if(!e)throw console.error("please provide github_url"),new Error("Error: please provide github_url");e=e.slice("https://github.com/".length);const[t,o]=e.split("/");return e="https://api.github.com/repos/"+t+"/"+o+"/issues",e}(),a=await async function(){const{stdout:e}=await r("git ls-tree --full-tree --name-only -r HEAD"),t=e.split("\n");return t.pop(),t}(),p=await async function(t){const o=/\/\/\s*TODO:\s*(.*)/g,n=[];for(const s of t){const t=(await i.readFile(c+"/"+s,"utf8")).match(o);null!==t&&(Array.isArray(t)?t.forEach((e=>{n.push(e)})):n.push(e))}const s=[];for(const e of n){const t={title:e.replace(/\/\/\s*TODO:/,"").trim()};s.push(t)}return s}(a);console.log(n,s);for(const e of p)o.create_issue(e.title,n,s)}()})()})();